<!DOCTYPE HTML>
<html>

<head>
	<p id="p1"> </p>
	<p id="p2"> </p>
	<p id="showTime"> </p>
	<script type="text/javascript" src="./info.json"></script>
	<script type="text/javascript">
	//the format of rttData is a list of 5 objects, where each object contains its IP and RTT(a list of 5 rtts)
	//document.getElementById("p1").innerHTML = "IP address is: " + rttData[4]["IP"];
	//document.getElementById("p2").innerHTML = "RTT is: " + rttData[4]["RTT"][4] + " ms";
	document.getElementById("showTime").innerHTML = "Hi, there!"
	
	//a test for getting current time 
	function getTime() {
	var currentdate = new Date();
	return currentdate.getHours() + ":"  
           + currentdate.getMinutes() + ":" 
           + currentdate.getSeconds();
	}
	
	//a test for showing local time
	function showTime() {
	var currentdate = new Date(); 
	var datetime = "Last Sync: " + (currentdate.getMonth()+1)  +  "/"
                +  currentdate.getDate() + "/" 
                + currentdate.getFullYear() + " @ "  
                + currentdate.getHours() + ":"  
                + currentdate.getMinutes() + ":" 
                + currentdate.getSeconds();
		document.getElementById("showTime").innerHTML = getTime();// datetime;
	}

	//<button type="button" onclick="showTime()">Click to show current time!</button>
	</script>

	<button type="button" onclick="showTime()">Click to show current time!</button>
	
	<script type="text/javascript" src="http://canvasjs.com/assets/script/canvasjs.min.js"></script>
</head>
<body>
	<script>
	//test for canvasJS chart
	window.onload = function () {
		
		var dataPoints1 = [];
		var dataPoints2 = [];
		var dataPoints3 = [];
		var dataPoints4 = [];
		var dataPoints5 = [];

		var chart = new CanvasJS.Chart("chartContainer",{
			theme: "theme3",
			title :{
				text: "Live IP RTT Data"
			},
            legend: {
                cursor: "pointer",
                itemclick: function (e) {
                //console.log("legend click: " + e.dataPointIndex);
                //console.log(e);
                if (typeof (e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
                     e.dataSeries.visible = false;
                } else {
                     e.dataSeries.visible = true;
                }
           
                e.chart.render();
                }
            },                           
			data: [
			{ 
				// dataSeries1
				type: "line",
				xValueType: "dateTime",
				showInLegend: true,
				name: "IP1( " + rttData[0]["IP"] + " )",
				dataPoints: dataPoints1
			},
			{				
				// dataSeries2
				type: "line",
				xValueType: "dateTime",
				showInLegend: true,
				name: "IP2( " + rttData[1]["IP"] + " )",
				dataPoints: dataPoints2
			},
			{				
				// dataSeries3
				type: "line",
				xValueType: "dateTime",
				showInLegend: true,
				name: "IP3( " + rttData[2]["IP"] + " )",
				dataPoints: dataPoints3
			},
			{				
				// dataSeries4
				type: "line",
				xValueType: "dateTime",
				showInLegend: true,
				name: "IP4( " + rttData[3]["IP"] + " )",
				dataPoints: dataPoints4
			},
			{				
				// dataSeries5
				type: "line",
				xValueType: "dateTime",
				showInLegend: true,
				name: "IP5( " + rttData[4]["IP"] + " )",
				dataPoints: dataPoints5
			}			
			],
			axisX: {
				title: "chart updates every 5 secs"
			},
		});	
		
		var updateInterval = 5000;
		//var rttInterval = 1000;
		// initial value
		var countRTT = 5;
		var dataLength = 100; // number of dataPoints visible at any point
		
		var yValue1; 
		var yValue2;
		var yValue3;
		var yValue4;
		var yValue5;
		
		//document.getElementById("p1").innerHTML = time.getTime();
		
		var updateChart = function (countRTT) {
			countRTT = countRTT || 5;  // if countRTT not mentioned, then use the latter value 
			// countRTT is number of times loop runs to get IP dataPoints.		
            
			var time = new Date;
			// rollback the timeInterval
			time.setTime(time.getTime() - (countRTT - 1) * updateInterval);
			
			for (var j = 0; j < countRTT; j++) {	
				
				// set the RTT time 
				yValue1 = Number(rttData[0]["RTT"][j]);
				yValue2 = Number(rttData[1]["RTT"][j]);
				yValue3 = Number(rttData[2]["RTT"][j]);
				yValue4 = Number(rttData[3]["RTT"][j]);
				yValue5 = Number(rttData[4]["RTT"][j]);
				
				//alert("yValue1 is" + yValue1.toString() );
				//alert("yValue2 is" + yValue2.toString() );
				
				// pushing the new values
				dataPoints1.push({
					x: time.getTime(),
					y: yValue1
				});
				dataPoints2.push({
					x: time.getTime(),
					y: yValue2
				});
				dataPoints3.push({
					x: time.getTime(),
					y: yValue3
				});
				dataPoints4.push({
					x: time.getTime(),
					y: yValue4
				});
				dataPoints5.push({
					x: time.getTime(),
					y: yValue5
				});
				
				// add interval duration to time				
				time.setTime(time.getTime()+ updateInterval);
							
			};
			
				if (dataPoints1.length > dataLength)
			{
				while (dataPoints1.length > dataLength)
			{
				dataPoints1.shift();	
				dataPoints2.shift();	
				dataPoints3.shift();
				dataPoints4.shift();
				dataPoints5.shift();
			}
			}

			chart.render();
		};
			
			// generates first set of dataPoints 
			updateChart();	
			
			// update chart after specified interval 
			setInterval(function(){updateChart()}, updateInterval);
	};
	</script>
	<div id="chartContainer" style="height: 350px; width:100%;">
	</div>
</body>
</html>